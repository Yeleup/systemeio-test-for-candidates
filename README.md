# Написать Symfony REST приложение для расчета цены продукта и проведения оплаты

Необходимо написать 2 эндпоинта:
1. POST: для расчёта цены
   
http://127.0.0.1:80/calculate-price

Пример json тела запроса:
```
{
    "product": 1,
    "taxNumber": "DE123456789",
    "couponCode": "D15"
}
```
2. POST: для выполнения покупки
   
http://127.0.0.1:80/purchase

Пример json тела запроса:
```
{
    "product": 1,
    "taxNumber": "IT12345678900",
    "couponCode": "D15",
    "paymentProcessor": "paypal"
}
```

При успешном выполнении запроса вернуть HTTP ответ с кодом 200.

При неверных входных данных или ошибках оплаты вернуть HTTP ответ с кодом 400 и json объект с ошибками.

## Продукты
- Iphone (100 евро)
- Наушники (20 евро)
- Чехол (10 евро)

## Купоны
При наличии купона покупатель может применить его к покупке.  
Купон может быть двух типов:
- фиксированная сумма скидки
- процент от суммы покупки

## Расчет налога
При покупке продукта получатель сверх цены продукта должен уплатить налог, относительно страны налогового номера:
- Германии - 19%
- Италии - 22%
- Франции - 20%
- Греции - 24%

В итоге для покупателя Iphone из Греции цена составляет 124 евро (цена продукта 100 евро + налог 24%).  
Если у покупателя есть купон на 6% скидку на покупку, то цена будет 116.56 евро (цена продукта 100 евро - 6% скидка + налог 24%).

## Формат налогового номера
DEXXXXXXXXX - для жителей Германии,

ITXXXXXXXXXXX - для жителей Италии,

GRXXXXXXXXX - для жителей Греции,

FRYYXXXXXXXXX - для жителей Франции

где: 
- первые два символа - это код страны,
- X - любая цифра от 0 до 9,
- Y - любая буква

Обратите внимание, что длина налогового номера разная для разных стран.  
Форматы налоговых номеров могут меняться, что случается редко. (Это зависит от законодательства.)

## Детали
При выполнении задания нужно:
- реализовать валидацию всех полей (в том числе корректность tax номера согласно формату) в теле запросов, используя Symfony validator
- рассчитать итоговую цену покупки вместе с купоном (если указан) и налогом
- использовать для проведения платежа `PaypalPaymentProcessor::pay()` или `StripePaymentProcessor::processPayment()`  
Эти классы представлены в этом проекте, использовать следует именно их. В методах оплаты они принимают цену как в разных юнитах (как в центах, так и в долларах).
    - ИЛИ скопируйте их себе в проект. Для простоты представьте, что эти два класса входят в два разных сторонних SDK, и у вас **нет возможности править эти классы или какую-либо логику внутри них**.
    - ИЛИ добавьте `systemeio/test-for-candidates` как зависимость через Composer.
- приложить в README.md примеры HTTP-запросов к двум эндпоинтам: path и тело запроса (для ручного тестирования) в формате curl команды

CRUD для сущностей писать не нужно.

При написании тестового используйте git, после выполнения пришлите ссылку на репозиторий.

Необходимо учесть возможность добавления новых PaymentProcessors.

### Будет плюсом
- использование контейнеризации для php, postgres/mysql
- наличие PHPUnit tests
- соответствие кода принципам SOLID (без фанатизма)
- покоммитное оформление этапов реализации приветствуется
- продемонстрированное умение **НЕ!** использовать подходы вроде onion-based/DDD/CQS/гексагональной архитектуры при выполнении задания: мы куда больше ценим его корректность и полноту; такие сложные концепции в нашем задании скорее не уместны

Мы не ограничиваем вас по срокам выполнения задания, но при этом ожидаем, что в тестовом задании вы раскроете принципы, которых придерживаетесь в работе.

# Инструкция по развёртыванию проекта

## Настройка окружения с помощью Docker

1. Вам необходимо запустить контейнеры Docker. Для этого используйте следующую команду: **docker compose up -d**
2. После запуска контейнеров выполните миграции базы данных командой: **docker exec -it test-for-candidate-myapp-1 php bin/console do:mi:mi**
3. Надо запустить фикстуры **docker exec -it test-for-candidate-myapp-1 php bin/console do:fi:lo**

## Отправка HTTP-запросов
Для работы с сервисом доступны следующие HTTP-эндпоинты:
1. **Расчёт цены:**
- **URL:** http://localhost:8200/calculate-price
- **Тело запроса (JSON):**
  ```json
  {
      "product": 1,
      "taxNumber": "GR123456789",
      "couponCode": "D15"
  }
  ```

2. **Совершение покупки:**
- **URL:** http://localhost:8200/purchase
- **Тело запроса (JSON):**
  ```json
  {
      "product": 1,
      "taxNumber": "IT12345678900",
      "couponCode": "D15",
      "paymentProcessor": "paypal"
  }
  ```

## Запуск тестов

Чтобы запустить тесты, выполните следующие шаги:

1. Сделайте скрипт тестирования исполняемым с помощью команды: **chmod +x tests.sh**
2. Запустите скрипт тестирования в контейнере: **docker exec -it test-for-candidate-myapp-1 ./tests.sh**